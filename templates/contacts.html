{% extends 'base_app.html'%}
{% block title %}
    Contacts
{% endblock title %}
{% block linklibs %}
    {% load  static %}
    <link rel="stylesheet" href="{% static  'Contacts.css'%}" media="screen">
{% endblock linklibs %}
{% block body %}

    <p>People API Quickstart</p>

    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize_button" style="display: none;">Authorize</button>
    <button id="signout_button" style="display: none;">Sign Out</button>

    <pre id="content" style="white-space: pre-wrap;"></pre>

    <script type="text/javascript">
      // Client ID and API key from the Developer Console
      var CLIENT_ID = '456816466000-fllno6mknd0nq7fivp486gkd7f35g00f';
      var API_KEY = 'AIzaSyCMTx5etLYcY_y56JQMnTkz1k7K28hWfeM';

      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/people/v1/rest"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/contacts";

      var list = document.getElementById('contacts')
      var authorizeButton = document.getElementById('authorize_button');
      var signoutButton = document.getElementById('signout_button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
        }, function(error) {
          appendPre(JSON.stringify(error, null, 2));
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          listConnectionNames();
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(person) {
        list.innerHTML += `<div class="u-container-style u-grey-5 u-list-item u-radius-5 u-repeater-item u-shape-round u-list-item-1">
            <div class="u-container-layout u-similar-container u-container-layout-2">
                <div class="u-image u-image-circle u-image-1" alt="" data-image-width="1280" data-image-height="853"></div>
                <h4 class="u-text u-text-default u-text-2">${person.names[0]}</h4><span class="u-file-icon u-icon u-icon-1"><img src="{% static  'images/icons8-phone.svg'%}" alt=""></span>
                <h5 class="u-text u-text-default u-text-3">${person.phoneNumbers[0]}</h5>
            </div>
        </div>`;
      }

      function listConnectionNames() {
        gapi.client.people.people.connections.list({
            'sortOrder': 'FIRST_NAME_ASCENDING',
           'personFields': 'names,phoneNumbers, photos'
         }).then(function(response) {
           var connections = response.result.connections;
           if (connections.length > 0) {
             for (i = 0; i < connections.length; i++) {
               var person = connections[i];
               if (person.names && person.names.length > 0) {
                 appendPre(person)
               } else {
                 appendPre("No display name found for connection.");
               }
             }
           } else {
             appendPre('No connections found.');
           }
         });
      }

    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <section class="u-align-center u-clearfix u-section-1" id="sec-453d">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-clearfix u-expanded-width u-layout-wrap u-layout-wrap-1">
          <div class="u-layout">
            <div class="u-layout-row">
              <div class="u-align-left u-container-style u-layout-cell u-size-30 u-layout-cell-1">
                <div class="u-container-layout u-container-layout-1">
                  <h2 class="u-align-center u-text u-text-1">Contacts</h2>
                  <div class="u-align-center u-form u-form-1">
                    <form action="#" method="POST" class="u-clearfix u-form-custom-backend u-form-horizontal u-form-spacing-10 u-inner-form" source="custom" name="form" style="padding: 0px;" redirect="true">
                      <input type="hidden" id="siteId" name="siteId" value="13704088">
                      <input type="hidden" id="pageId" name="pageId" value="81874407">
                      <div class="u-form-group u-form-name">
                        <label for="name-a49c" class="u-form-control-hidden u-label"></label>
                        <input type="text" placeholder="Search Contacts" id="name-a49c" name="contact" class="u-border-1 u-border-grey-30 u-input u-input-rectangle u-white" required="">
                      </div>
                      <div class="u-align-left u-form-group u-form-submit">
                        <a href="#" class="u-black u-border-none u-btn u-btn-submit u-button-style u-btn-1">Search</a>
                        <input type="submit" value="submit" class="u-form-control-hidden">
                      </div>
                      <div class="u-form-send-message u-form-send-success"></div>
                      <div class="u-form-send-error u-form-send-message"></div>
                      <input type="hidden" value="" name="recaptchaResponse">
                    </form>
                  </div>
                  <div class="u-align-center u-list u-list-1">
                    <div id = 'contacts' class="u-repeater u-repeater-1">
                    </div>
                  </div>
                </div>
              </div>
              <div class="u-container-style u-custom-border u-layout-cell u-size-30 u-layout-cell-2">
                <div class="u-border-1 u-border-grey-15 u-border-no-bottom u-border-no-right u-border-no-top u-container-layout u-container-layout-7">
                  <h2 class="u-align-center u-text u-text-12">Call Log</h2>
                  <div class="u-align-center u-list u-list-2">
                    <div class="u-repeater u-repeater-2">
                      <div class="u-container-style u-grey-5 u-list-item u-radius-5 u-repeater-item u-shape-round u-list-item-6">
                        <div class="u-container-layout u-similar-container u-container-layout-8">
                          <div class="u-image u-image-circle u-image-6" alt="" data-image-width="1280" data-image-height="853"></div>
                          <h4 class="u-text u-text-default u-text-13">Sonani Kahan</h4><span class="u-file-icon u-icon u-icon-6"><img src="{% static  'images/icons8-missed-call.svg'%}" alt=""></span><span class="u-file-icon u-icon u-icon-7"><img src="{% static  'images/icons8-phone.svg'%}" alt=""></span>
                          <h5 class="u-text u-text-default u-text-14">Yesterday</h5>
                        </div>
                      </div>
                      <div class="u-container-style u-grey-5 u-list-item u-radius-5 u-repeater-item u-shape-round u-list-item-7">
                        <div class="u-container-layout u-similar-container u-container-layout-9">
                          <div class="u-image u-image-circle u-image-7" alt="" data-image-width="1280" data-image-height="853"></div>
                          <h4 class="u-text u-text-default u-text-15">John Doe</h4><span class="u-file-icon u-icon u-icon-8"><img src="{% static  'images/icons8-missed-call.svg'%}" alt=""></span><span class="u-file-icon u-icon u-icon-9"><img src="{% static  'images/icons8-phone.svg'%}" alt=""></span>
                          <h5 class="u-text u-text-default u-text-16">2 hours ago</h5>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
{% endblock body %}